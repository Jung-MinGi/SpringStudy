<h2>ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œ</h2>
ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œëŠ” ë¦¬í”Œë ‰ì…˜ ê¸°ëŠ¥ì„ ì´ìš©í•´ì„œ í”„ë¡ì‹œë¥¼ ë§Œë“¤ì–´ì¤€ë‹¤

ë¦¬í”Œë ‰ì…˜ì´ë€

ìë°”ì½”ë“œìì²´ë¥¼ ì¶”ìƒí™”í•´ì„œ ì ‘ê·¼ê°€ëŠ¥í•˜ë„ë¡ ë§Œë“¤ ê²ƒ

ìë°”ì˜ ëª¨ë“  í´ë˜ìŠ¤ëŠ” í´ë˜ìŠ¤ìì²´ì˜ êµ¬ì„±ì •ë³´ë¥¼ ë‹´ì€ Classíƒ€ì…ì˜ ì˜¤ë¸Œì íŠ¸ë¥¼ í•˜ë‚˜ì”© ê°–ê³  ìˆë‹¤.

![image](https://github.com/Jung-MinGi/SpringStudy/assets/118701129/8a9759f1-fa8c-42f9-a19a-6e2d475235f2)

Stringí´ë˜ìŠ¤ê°€ ê°€ì§€ëŠ” ë©”ì„œë“œì˜ ì„ ì–¸ë¶€ë¥¼ ì´ë ‡ê²Œ ì•Œ ìˆ˜ ìˆë‹¤.

invokeë©”ì„œë“œë¥¼ ì´ìš©í•´ íŠ¹ì • ë©”ì„œë“œë¥¼ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ë„ ìˆë‹¤.

ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œ ë™ì‘ë°©ì‹

![image](https://github.com/Jung-MinGi/SpringStudy/assets/118701129/a778576f-f366-48fb-a0c0-e65209ee3371)


ì¶œì²˜ https://jongmin92.github.io/2018/04/15/Spring/toby-6/#google_vignette

1. ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œëŠ” í”„ë¡ì‹œ íŒ©í† ë¦¬ì— ì˜í•´ ëŸ°íƒ€ì„ ì‹œ ë‹¤ì´ë‚´ë¯¹í•˜ê²Œ ë§Œë“¤ì–´ì§€ëŠ” ì˜¤ë¸Œì íŠ¸ í”„ë¡ì‹œ íŒ©í† ë¦¬ì—ê²Œ íƒ€ê¹ƒì¸í„°í˜ì´ìŠ¤ë¥¼ ë„˜ê¸°ë©´ íƒ€ê¹ƒì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ëŠ” í”„ë¡ì‹œë¥¼ ë§Œë“¤ì–´ì£¼ë¯€ë¡œ ê°œë°œìê°€ í¸í•˜ë‹¤.

2. ê°œë°œìëŠ” ì›í•˜ëŠ” ë¶€ê°€ê¸°ëŠ¥ì„ ë‹´ì€ ì½”ë“œë¥¼ invocationHandlerë¥¼ êµ¬í˜„í•´ì„œ ë§Œë“¤ë©´ ë¨

ğŸ§ ì™¸ë¶€APIì™€ ì—°ë™í•´ ë¹„íŠ¸ì½”ì¸ ì‹¤ì‹œê°„ ê°€ê²©ì„ ì›í™”ë¡œ ì¡°íšŒí›„ ì´ë¥¼ ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œë¥¼ ì´ìš©í•´ì„œ ë‹¬ëŸ¬ë‹¨ìœ„ë¡œ ë³€í™˜í•´ì„œ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì œê³µí•˜ê¸°

âœ“ Bitcoin ì¸í„°í˜ì´ìŠ¤ ìƒì„±

```
public interface Bitcoin {
    int getPrice();
}
```
âœ“ ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì†í•œ íƒ€ê¹ƒí´ë˜ìŠ¤(ì‹¤ì œ í´ë¼ì´ì–´íŠ¸ì˜ ìš”ì²­ì— ëŒ€í•œ ê²°ê³¼ë¥¼ ëŒë ¤ì£¼ëŠ” í´ë˜ìŠ¤)(ë‹¨ìˆœíˆ í˜„ì¬ ë¹„íŠ¸ì½”ì¸ ê°€ê²©ì„ ë‹¬ëŸ¬ê¸°ì¤€ìœ¼ë¡œ ì•Œë ¤ì¤€ë‹¤.)

```
public class BitcoinTarget implements Bitcoin {
    @Override
    public int getPrice() {
        try {
            RestTemplate restTemplate = new RestTemplate();
            String forObject = restTemplate.getForObject(
             new URI("https://api.upbit.com/v1/ticker?markets=KRW-BTC")
             , String.class);
            ObjectMapper objectMapper = new ObjectMapper();
            JsonNode jsonNode = objectMapper.readTree(forObject);
            String s = jsonNode.findValuesAsText("trade_price").get(0);
            double l = Double.parseDouble(s);
            return (int) l;
        } catch (JsonProcessingException e) {
            throw new RuntimeException(e);
        } catch (URISyntaxException e) {
            throw new RuntimeException(e);
        }
    }
}
```
ì‹¤ì œ ì˜ë¯¸ìˆëŠ” í´ë˜ìŠ¤ë¼ê³  ë³´ë©´ ëœë‹¤.

âœ“  íƒ€ì¼“í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” í´ë¼ì´ì–¸íŠ¸ ìƒì„±

![image](https://github.com/Jung-MinGi/SpringStudy/assets/118701129/362caada-0bb2-459b-b61d-5b86d217a7c1)


í”„ë¡ì‹œë¥¼ ì ìš©ì•ˆí–ˆì„ë• ì›í™”ê°€ê²© ê·¸ëŒ€ë¡œ ë³´ì—¬ì¤Œ 

![image](https://github.com/Jung-MinGi/SpringStudy/assets/118701129/b887363e-e489-4a11-bc1d-61d43bd70660)


ğŸ§ë‹¤ì´ë‚´ë¯¹í”„ë¡ì‹œ ìƒì„±

ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œëŠ” í”„ë¡ì‹œ íŒ©í† ë¦¬ì— ì˜í•´ ëŸ°íƒ€ì„ ì‹œ ë‹¤ì´ë‚´ë¯¹í•˜ê²Œ ë§Œë“¤ì–´ì§€ëŠ” ì˜¤ë¸Œì íŠ¸ì´ë‹¤. ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œ ì˜¤ë¸Œì íŠ¸ëŠ” íƒ€ê¹ƒ ì¸í„°í˜ì´ìŠ¤ì™€ ê°™ì€ íƒ€ì…ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ë‹¤. í”„ë¡ì‹œ íŒ©í† ë¦¬ì—ì„œ êµ¬í˜„í•  ì¸í„°í˜ì´ìŠ¤ ì •ë³´ë§Œ ì œê³µí•˜ë©´  í•´ë‹¹ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ ì˜¤ë¸Œì íŠ¸ë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•´ì¤€ë‹¤ ê·¸ëŸ¼ ê°œë°œìëŠ” í”„ë¡ì‹œì— ë‹´ì„ ë¶€ê°€ê¸°ëŠ¥ë§Œ ì •ì˜í•´ì£¼ë©´ ëœë‹¤. ë¶€ê°€ê¸°ëŠ¥ì€ InvocationHandlerë¥¼ êµ¬í˜„í•œ ì˜¤ë¸Œì íŠ¸ì— ë‹´ëŠ”ë‹¤

êµ¬ì¡°: ë‹¤ì´ë‚´ë¯¹í”„ë¡ì‹œâ€“â†’InvocationHandlerë¥¼ êµ¬í˜„í•œ í´ë˜ìŠ¤â€“â†’targetí´ë˜ìŠ¤

![image](https://github.com/Jung-MinGi/SpringStudy/assets/118701129/a436734b-de6b-47cd-acbd-380d083c5c1c)


ì´ ì½”ë“œê°€ í”„ë¡ì‹œíŒ©í† ë¦¬ì—ê²Œ ë‹¤ì´ë‚´ë¯¹í”„ë¡ì‹œë¥¼ ë§Œë“¤ì–´ë‹¬ë¼ëŠ” ì½”ë“œì„

ìƒì„±í•˜ë©´ì„œ 3ë²ˆì§¸ íŒŒë¼ë¯¸í„°ì— InvocationHandlerë¥¼ êµ¬í˜„í•œ í´ë˜ìŠ¤ ë„˜ê²¨ì£¼ë©´ ì¸í„°í˜ì´ìŠ¤ì— ì¡´ì¬í•˜ëŠ” ëª¨ë“  ë©”ì„œë“œê°€ InvocationHandlerë¥¼ êµ¬í˜„í•œ í´ë˜ìŠ¤ì•ˆì— ìˆëŠ” invokeë©”ì„œë“œë¥¼ ê±°ì³ì„œ íƒ€í‚·í´ë˜ìŠ¤ë¡œ ë„˜ì–´ê°€ê²Œë¨.

ì²«ë²ˆì§¸ íŒŒë¼ë¯¸í„°: ì•„ì§ ì˜ ëª¨ë¥´ê² ë‹¤ ..

ë‘ë²ˆì§¸ íŒŒë¼ë¯¸í„°: ë‹¤ì´ë‚´ë¯¹í”„ë¡ì‹œê°€ êµ¬í˜„í•  ì¸í„°í˜ì´ìŠ¤

ì„¸ë²ˆì§¸ íŒŒë¼ë¯¸í„°: ê°œë°œìê°€ ë§Œë“  ë¶€ê°€ê¸°ëŠ¥ì´ ìˆëŠ” í´ë˜ìŠ¤ì™€ íƒ€ê¹ƒí´ë˜ìŠ¤

ğŸ§ ì›í™”ë¥¼ ë‹¬ëŸ¬ë¡œ ë³€í™˜í•´ì£¼ëŠ” ë¶€ê°€ê¸°ëŠ¥ì„ ì§€ë‹Œ í´ë˜ìŠ¤

ì´ í´ë˜ìŠ¤ì—ì„œ íƒ€ê¹ƒë©”ì„œë“œë¥¼ í˜¸ì¶œí•´ì¤€ë‹¤.

![image](https://github.com/Jung-MinGi/SpringStudy/assets/118701129/b6d1d0c9-8fbf-46be-8300-360ce53bce10)


```
public class ClientUsingTargetClass {
    public static void main(String[] args) throws URISyntaxException, JsonProcessingException {

        Bitcoin dynamicProxy = (Bitcoin) Proxy.newProxyInstance(
                ClientUsingTargetClass.class.getClassLoader()
                , new Class[]{Bitcoin.class}
                , new ChangeKRWToUS(new BitcoinTarget()));


        int price = dynamicProxy.getPrice();
        
        System.out.println("ë¹„íŠ¸ì½”ì¸ ë‹¬ëŸ¬ê°€ê²© = " + price+"USD");
    }
}
```
ê·¸ë¦¬ê³  clientìª½ì—ì„œ ì‚¬ìš©í•  ë©”ì„œë“œë¥¼ í˜¸ì¶œí•´ì£¼ë©´ ëœë‹¤

ê²°ê³¼

![image](https://github.com/Jung-MinGi/SpringStudy/assets/118701129/7c5c4a8c-e7ff-42ae-9d15-d4357605c0f5)




ğŸ§íŒ©í† ë¦¬ë¹ˆì„ í™œìš©í•œ ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œ ìƒì„±ì „ëµ

íŒ©í† ë¦¬ ë¹ˆì„ í™œìš©í•´ ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œ ìƒì„±í•˜ëŠ” í´ë˜ìŠ¤ì¤‘ getObject()ë©”ì„œë“œ

![image](https://github.com/Jung-MinGi/SpringStudy/assets/118701129/a9ad356c-cf12-4e43-8d27-92b4787f4f8c)


transactionHandler--ê°œë°œìê°€ ì›í•˜ëŠ” ë¶€ê°€ê¸°ëŠ¥ ì½”ë“œ ì´ì•ˆì—ì„œ íŠ¸ëœì­ì…˜ ê²½ê³„ì„¤ì •ì´ ì‹œì‘

targetë³€ìˆ˜--ì‹¤ì œ íƒ€ê¹ƒí´ë˜ìŠ¤ë¥¼ ì§€ì¹­í•¨ 

pattern--íŠ¸ëœì­ì…˜ ì ìš©ëŒ€ìƒ ë©”ì„œë“œì´ë¦„ì„ ì•Œë ¤ì¤Œ

serviceInterface--í”„ë¡ì‹œê°€ ì–´ë–¤ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•´ì•¼ í• ì§€ ì•Œë ¤ì¤Œ

ğŸ§ì„¤ì •ì •ë³´

![image](https://github.com/Jung-MinGi/SpringStudy/assets/118701129/f82f80aa-a6de-4339-a8c5-8dfd572b1a30)


â€»í…ŒìŠ¤íŠ¸ ì½”ë“œ

@Test
@DisplayName("ë ˆë²¨ ì—…ê·¸ë ˆì´ë“œ ë¡¤ë°± í™•ì¸")
public void upgradeAllOrNothing() {

    TestUserService testUserService = new TestUserService(users.get(3).getId());
    testUserService.setUserDao(userDao);
    testUserService.setMailSender(mailSender);

    TrProxyFactoryBean bean = context.getBean("&userService", TrProxyFactoryBean.class);
    bean.setTarget(testUserService);
    UserService dynamicProxy = context.getBean("userService", UserService.class);
    
    userDao.deleteAll();
    for (User user : users) {
        userDao.add(user);
    }
    Assertions.assertThatThrownBy(dynamicProxy::upgradeLevels)
            .isInstanceOf(TestUserServiceException.class);

    checkLevel(users.get(1), false);
}
